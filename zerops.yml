zerops:
  - setup: nodejs20
    build:
      os: alpine
      base: nodejs@20
      prepareCommands:
        - npm install -g typescript
      buildCommands:
        - |
          cd nodejs
          export NODE_ENV=development
          npm i
          npm run build
      deploy:
        - ./nodejs/~/dist
        - ./nodejs/~/node_modules
        - ./nodejs/~/package.json
    run:
      os: alpine
      base: nodejs@20
      start: npm run start:prod
      healthCheck:
        httpGet:
          port: 3000
          path: /status

  - setup: golang1
    build:
      os: alpine
      base: go@1
      buildCommands:
        - |
          cd golang
          go build -o golang ./...
      deploy:
        - ./golang/~/golang
    run:
      os: alpine
      base: golang@latest
      start: ./golang
      healthCheck:
        httpGet:
          port: 8080
          path: /status

  - setup: phpapache81
    build:
      os: alpine
      base: php@8.1
      buildCommands:
        - |
          cd php
          composer install --optimize-autoloader --no-dev
      deploy:
        - ./php/~/index.php
        - ./php/~/.htaccess
        - ./php/~/vendor
    run:
      os: alpine
      base: php-apache@8.1
      documentRoot: ./
      healthCheck:
        httpGet:
          port: 80
          path: /status

  - setup: phpnginx81
    build:
      os: alpine
      base: php@8.1
      buildCommands:
        - |
          cd php
          composer install --optimize-autoloader --no-dev
      deploy:
        - ./php/~/index.php
        - ./php/~/vendor
    run:
      os: alpine
      base: php-nginx@8.1
      healthCheck:
        httpGet:
          port: 80
          path: /status

  - setup: phpnginx83
    build:
      os: alpine
      base: php@8.3
      buildCommands:
        - |
          cd php
          composer install --optimize-autoloader --no-dev
      deploy:
        - ./php/~/index.php
        - ./php/~/vendor
        - ./php/nginx.conf
    run:
      os: alpine
      base: php-nginx@latest
      nginx: nginx.conf
      healthCheck:
        httpGet:
          port: 80
          path: /status

  - setup: rust1
    build:
      os: alpine
      base: rust@latest
      buildCommands:
        - |
          zsc noop
          cd rust
          cargo build --release
      deploy:
        - ./rust/target/release/~/rust
    run:
      os: alpine
      base: rust@latest
      start: ./rust
      healthCheck:
        httpGet:
          port: 8080
          path: /status

  - setup: dotnet60
    build:
      os: alpine
      base: dotnet@6
      buildCommands:
        - |
          cd dotnet
          dotnet publish -c Release -o publish
      deploy:
        - ./dotnet/publish/~
    run:
      os: alpine
      base: dotnet@6
      start: dotnet ./dotnet.dll
      healthCheck:
        httpGet:
          port: 5000
          path: /status

  - setup: python311
    build:
      os: alpine
      base: python@3.11
      deploy:
        - python/~app.py
      addToRunPrepare:
        - python/requirements.txt
    run:
      os: alpine
      base: python@latest
      prepareCommands:
        - "apk add --no-cache --virtual .build-deps libpq-dev gcc musl-dev postgresql-dev"
        - "python3 -m pip install --ignore-installed -r python/requirements.txt"
        - "apk --purge del .build-deps"
      start: python3 app.py
      healthCheck:
        httpGet:
          port: 8000
          path: /status
